<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Project: Ma S√≥i</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* CORE */
        * { box-sizing: border-box; scrollbar-width: thin; scrollbar-color: #555 #111; user-select: none; }
        body { 
            background: #050505; color: #e0e0e0; font-family: 'VT323', monospace;
            font-size: 18px; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden;
        }
        
        /* HEADER */
        .top-bar { 
            background: #111; border-bottom: 2px solid #333; padding: 0 15px; 
            display: flex; justify-content: space-between; align-items: center; height: 50px; flex-shrink: 0;
        }
        .title { color: #e94560; font-size: 24px; letter-spacing: 2px; }
        .room-info { font-size: 20px; color: #fcd34d; cursor: pointer; border: 1px dashed #555; padding: 0 10px; }
        
        /* LAYOUT MAIN */
        .container { display: flex; flex: 1; overflow: hidden; position: relative; }
        
        /* SIDEBARS & MAIN AREA (M·∫∑c ƒë·ªãnh cho Desktop) */
        .sidebar { width: 250px; background: #080808; border-right: 1px solid #333; display: flex; flex-direction: column; flex-shrink: 0; }
        .sidebar-right { width: 300px; border-left: 1px solid #333; border-right: none; background: #0a0a0a; display: flex; flex-direction: column; }
        .main-area { flex: 1; display: flex; flex-direction: column; background: #000; overflow: hidden; }

        .panel-header { background: #151515; padding: 5px 10px; font-size: 20px; color: #888; border-bottom: 1px solid #333; display: flex; justify-content: space-between; }
        
        /* PLAYER LIST */
        #player-list { flex: 1; overflow-y: auto; padding: 5px; }
        .player-row { display: flex; justify-content: space-between; padding: 5px 10px; background: #111; margin-bottom: 2px; font-size: 18px; align-items: center; }
        .p-alive { color: #4caf50; } .p-dead { color: #666; text-decoration: line-through; }
        .kick-x { color: #d00; cursor: pointer; margin-left: 10px; padding: 0 5px; border: 1px solid #333; }

        /* --- FACTION ROWS --- */
        .faction-row {
            flex: 1; display: flex; flex-direction: row; border-bottom: 1px solid #222;
            position: relative; overflow: hidden;
        }
        .faction-label {
            writing-mode: vertical-rl; text-orientation: mixed; transform: rotate(180deg);
            width: 40px; display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: bold; letter-spacing: 3px; border-right: 1px solid #333;
            flex-shrink: 0; z-index: 20; background: #050505;
        }
        .lbl-villager { color: #4caf50; border-right-color: #1b5e20; }
        .lbl-wolf { color: #ff5252; border-right-color: #b71c1c; }
        .lbl-neutral { color: #e040fb; border-right-color: #4a148c; }

        /* SLIDER CONTAINER */
        .slider-wrapper {
            flex: 1; display: flex; align-items: center; overflow-x: auto; 
            scroll-snap-type: x mandatory; padding: 0 40%;
            gap: 20px; position: relative; z-index: 10;
        }
        .slider-wrapper::-webkit-scrollbar { height: 4px; } /* M·ªèng h∆°n cho mobile */
        .slider-wrapper::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

        /* --- M≈®I T√äN CH·ªà TH·ªä --- */
        .center-marker {
            position: absolute; 
            left: calc(50% - 70px); top: 0; bottom: 0;
            width: 150px; transform: translateX(-50%);
            pointer-events: none; z-index: 5;
            display: flex; flex-direction: column; justify-content: space-between; align-items: center;
            padding: 5px 0;
        }
        .arrow-down, .arrow-up {
            width: 0; height: 0; filter: drop-shadow(0 0 5px #fcd34d);
        }
        .arrow-down { border-left: 10px solid transparent; border-right: 10px solid transparent; border-top: 10px solid #fcd34d; animation: bounceDown 1.5s infinite; }
        .arrow-up { border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 10px solid #fcd34d; animation: bounceUp 1.5s infinite; }
        @keyframes bounceDown { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }
        @keyframes bounceUp { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* CARD STYLE */
        .card {
            scroll-snap-align: center;
            width: 120px; height: 170px; /* Nh·ªè h∆°n x√≠u cho mobile */
            background: #111; border: 2px solid #444; border-radius: 10px;
            flex-shrink: 0; position: relative;
            transition: all 0.3s; opacity: 0.3; transform: scale(0.85); filter: grayscale(80%);
            cursor: pointer; overflow: hidden;
        }
        .card.active { opacity: 1; transform: scale(1.1); filter: grayscale(0%); border-color: #fff; z-index: 15; }
        .card-img { width: 100%; height: 100%; object-fit: cover; }
        
        .qty-badge {
            position: absolute; top: 5px; right: 5px;
            background: #e94560; color: #fff; width: 24px; height: 24px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 14px; font-weight: bold; border: 2px solid #fff; box-shadow: 0 2px 4px #000;
            display: none; z-index: 20;
        }

        /* ZOOM BUTTON */
        .zoom-btn {
            position: absolute; bottom: 5px; right: 5px; width: 24px; height: 24px;
            background: rgba(0,0,0,0.7); border: 1px solid #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; font-size: 14px; color: #fff; z-index: 25;
        }

        /* CONTROL PANEL */
        .row-control {
            width: 160px; background: #0e0e0e; border-left: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 5px; flex-shrink: 0; z-index: 20;
        }
        .ctrl-role-name { color: #fcd34d; font-size: 20px; text-align: center; margin-bottom: 2px; line-height: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; }
        .ctrl-role-desc { color: #777; font-size: 14px; text-align: center; margin-bottom: 5px; height: 32px; overflow: hidden; line-height: 1.1; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;}
        
        .ctrl-inputs { display: flex; align-items: center; gap: 5px; }
        .btn-qty { width: 40px; height: 35px; background: #333; color: #fff; border: 1px solid #555; font-size: 24px; display: flex; align-items: center; justify-content: center; }
        .inp-qty { width: 40px; height: 35px; background: #000; border: 1px solid #444; color: #fff; text-align: center; font-size: 20px; }

        /* BOTTOM BAR & TABS */
        .control-bar { 
            height: 55px; background: #111; border-top: 2px solid #333; padding: 0 10px;
            display: flex; justify-content: space-between; align-items: center; flex-shrink: 0;
            z-index: 50;
        }
        .mobile-tabs { display: none; } /* ·∫®n tr√™n Desktop */

        .btn-start { background: #2e7d32; color: white; padding: 5px 20px; font-size: 20px; border: 2px solid #1b5e20; width: 100%; max-width: 200px; }
        
        /* LOG & CHAT */
        #log-console { flex: 1; overflow-y: auto; padding: 10px; font-size: 16px; color: #ccc; }
        .chat-controls { display: flex; gap: 5px; padding: 10px; border-top: 1px solid #333; background: #111; height: 50px; }
        #admin-msg-input { flex: 1; background: #000; border: 1px solid #444; color: #fff; padding: 5px; font-size: 16px; }

        /* MODAL */
        #card-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: none; align-items: center; justify-content: center; flex-direction: column; }
        .modal-content { width: 80%; max-width: 340px; aspect-ratio: 260/380; }
        .modal-img { width: 100%; height: 100%; object-fit: contain; border-radius: 15px; border: 2px solid #555; background: #000; }
        .modal-close-hint { margin-top: 20px; color: #888; }

        /* N√∫t End Talk nh·ªè ·ªü Header (M·∫∑c ƒë·ªãnh ·∫©n tr√™n PC) */
        .header-btn {
            font-size: 14px; background: #b8d323; border: none; color: #000; cursor: pointer;
            padding: 2px 10px; border-radius: 4px; display: none; /* Desktop ·∫©n */
        }

        /* ========================================= */
        /* MOBILE RESPONSIVE CSS (Magic happens here) */
        /* ========================================= */
        @media (max-width: 768px) {
            /* ·∫®n hi·ªán c√°c c·ªôt d·ª±a tr√™n Tab */
            .sidebar, .sidebar-right, .main-area { display: none; width: 100%; height: 100%; }
            .sidebar.active, .sidebar-right.active, .main-area.active { display: flex; }

            /* ƒêi·ªÅu ch·ªânh Main Area cho Mobile */
            .faction-row { 
                flex-direction: column; /* X·∫øp d·ªçc */
                border-bottom: 2px solid #222;
            }
            
            /* Label n·∫±m ngang tr√™n c√πng */
            .faction-label {
                writing-mode: horizontal-tb; transform: none;
                width: 100%; height: 25px; font-size: 16px; letter-spacing: 5px;
                border-right: none; border-bottom: 1px solid #333;
            }

            /* Slider ·ªü gi·ªØa */
            .slider-wrapper { padding: 0 50%; width: 100%; }
            
            /* Control n·∫±m d∆∞·ªõi c√πng, n·∫±m ngang */
            .row-control {
                width: 100%; height: 50px; border-left: none; border-top: 1px solid #333;
                flex-direction: row; justify-content: space-between; padding: 0 10px;
            }
            .ctrl-role-desc { display: none; } /* ·∫®n m√¥ t·∫£ cho g·ªçn */
            .ctrl-role-name { font-size: 18px; text-align: left; margin: 0; flex: 1; }
            .ctrl-inputs { flex-shrink: 0; }

            /* Ch·ªânh l·∫°i Center Marker cho Mobile */
            .center-marker {
                left: 50%; top: 25px; bottom: 50px; /* N√© Label v√† Control ra */
                width: 100%; transform: translateX(-50%);
            }
            .arrow-down { border-top-width: 8px; border-left-width: 8px; border-right-width: 8px; }
            .arrow-up { border-bottom-width: 8px; border-left-width: 8px; border-right-width: 8px; }

            /* Bottom Bar th√†nh Tab Bar */
            .control-bar { padding: 0; justify-content: center; height: 50px; background: #000; }
            .counter-box { display: none; } 
            
            /* ·∫®N C√ÅC N√öT DESKTOP TR√äN MOBILE (Start + End Talk ·ªü d∆∞·ªõi ƒë√°y) */
            #desktop-btns { display: none !important; }

            /* HI·ªÜN N√öT END TALK ·ªû HEADER (Ch·ªâ Mobile m·ªõi c·∫ßn) */
            .header-btn { display: inline-block; }

            /* THANH TAB NAVIGATION */
            .mobile-tabs {
                display: flex; width: 100%; height: 100%;
            }
            .tab-btn {
                flex: 1; background: #111; border: none; border-top: 2px solid #333;
                color: #666; font-family: 'VT323'; font-size: 18px;
                display: flex; flex-direction: column; align-items: center; justify-content: center;
                cursor: pointer;
            }
            .tab-btn.active { background: #222; color: #e94560; border-top-color: #e94560; }
            .tab-icon { font-size: 20px; margin-bottom: 2px; }

            /* N√∫t Start Game n·ªïi l√™n tr√™n */
            #floating-start-btn {
                position: absolute; bottom: 60px; right: 10px;
                background: #2e7d32; color: #fff; padding: 10px 20px;
                border-radius: 30px; border: 2px solid #fff; box-shadow: 0 4px 10px #000;
                z-index: 100; font-family: 'VT323'; font-size: 20px;
                display: flex; align-items: center; gap: 5px;
            }
        }
    </style>
</head>
<body>

    <div id="card-modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()"> 
            <img id="modal-img-display" class="modal-img" src="">
        </div>
        <div class="modal-close-hint">CH·∫†M RA NGO√ÄI ƒê·ªÇ ƒê√ìNG</div>
    </div>

    <button id="floating-start-btn" onclick="startGame()" style="display:none">
        ‚ñ∂ B·∫ÆT ƒê·∫¶U (<span id="float-roles">0</span>/<span id="float-players">0</span>)
    </button>

    <div class="top-bar">
        <div class="title">WEREWOLF: THE GAME <span style="font-size:14px; color:#666">dev by qhatsdaoo</span></div>
        <div class="room-info" onclick="copyRoomID()">ID: <span id="room-id-display">...</span></div>
    </div>

    <div class="container">
        <div class="sidebar" id="tab-players">
            <div class="panel-header">
                <span>PLAYERS</span> <span id="p-count">0</span>
            </div>
            <div id="player-list"></div>
        </div>

        <div class="main-area active" id="tab-setup">
            <div class="faction-row">
                <div class="faction-label lbl-villager">VILLAGE</div>
                <div class="center-marker"><div class="arrow-down"></div><div class="arrow-up"></div></div>
                <div class="slider-wrapper" id="slider-villager"></div>
                <div class="row-control" id="ctrl-villager"><div style="color:#444">...</div></div>
            </div>
            <div class="faction-row">
                <div class="faction-label lbl-wolf">WOLF</div>
                <div class="center-marker"><div class="arrow-down"></div><div class="arrow-up"></div></div>
                <div class="slider-wrapper" id="slider-wolf"></div>
                <div class="row-control" id="ctrl-wolf"><div style="color:#444">...</div></div>
            </div>
            <div class="faction-row">
                <div class="faction-label lbl-neutral">NEUTRAL</div>
                <div class="center-marker"><div class="arrow-down"></div><div class="arrow-up"></div></div>
                <div class="slider-wrapper" id="slider-neutral"></div>
                <div class="row-control" id="ctrl-neutral"><div style="color:#444">...</div></div>
            </div>
        </div>

        <div class="sidebar sidebar-right" id="tab-logs">
            <div class="panel-header">
                SYSTEM LOG 
                <button class="header-btn" onclick="endDiscuss()">END_TALK</button>
            </div>
            <div id="log-console"></div>
            <div class="chat-controls">
                <input type="text" id="admin-msg-input" placeholder="Nh·∫Øn c·∫£ l√†ng..." onkeydown="if(event.key==='Enter') sendAdminChat()">
                <button onclick="sendAdminChat()" style="background:#e94560; color:#fff; border:none; padding:0 15px;">SEND</button>
            </div>
        </div>
    </div>

    <div class="control-bar">
        <div class="counter-box" style="font-size:24px; color:#aaa; display:block;">
             <span id="total-roles" style="color:#fff; font-weight:bold">0</span> / <span id="total-players" style="color:#fff">0</span>
        </div>
        <div style="display:flex; gap:10px" id="desktop-btns">
            <button class="btn-skip" onclick="endDiscuss()" style="background-color: #b8d323; color: #000;">END_TALK</button>
            <button id="btn-start" class="btn-start" onclick="startGame()">START GAME</button>
        </div>

        <div class="mobile-tabs">
            <button class="tab-btn" onclick="switchTab('players')" id="btn-tab-players">
                <div>üë•</div> PLAYERS
            </button>
            <button class="tab-btn active" onclick="switchTab('setup')" id="btn-tab-setup">
                <div>üé¥</div> CARDS
            </button>
            <button class="tab-btn" onclick="switchTab('logs')" id="btn-tab-logs">
                <div>üí¨</div> LOGS
            </button>
        </div>
    </div>

    <script>
        const socket = io();
        let myRoomId = null;
        let GLOBAL_CONFIG = {};
        let SELECTED_COUNTS = {}; 
        let ACTIVE_ROLES = { villager: null, wolf: null, neutral: null };

        // --- MOBILE TAB LOGIC ---
        function switchTab(tabName) {
            // ·∫®n h·∫øt
            document.getElementById('tab-players').classList.remove('active');
            document.getElementById('tab-setup').classList.remove('active');
            document.getElementById('tab-logs').classList.remove('active');
            
            // B·ªè active n√∫t
            document.getElementById('btn-tab-players').classList.remove('active');
            document.getElementById('btn-tab-setup').classList.remove('active');
            document.getElementById('btn-tab-logs').classList.remove('active');

            // Hi·ªán tab ch·ªçn
            document.getElementById('tab-' + tabName).classList.add('active');
            document.getElementById('btn-tab-' + tabName).classList.add('active');

            // Hi·ªÉn th·ªã n√∫t Start n·ªïi n·∫øu ·ªü tab Setup
            const floatBtn = document.getElementById('floating-start-btn');
            if(window.innerWidth <= 768 && tabName === 'setup') {
                floatBtn.style.display = 'flex';
            } else {
                floatBtn.style.display = 'none';
            }
        }

        // Check resize ƒë·ªÉ ·∫©n hi·ªán n√∫t float
        window.addEventListener('resize', () => {
            if(window.innerWidth > 768) document.getElementById('floating-start-btn').style.display = 'none';
            else if(document.getElementById('tab-setup').classList.contains('active')) {
                document.getElementById('floating-start-btn').style.display = 'flex';
            }
        });


        // --- SOCKET & CORE LOGIC ---
        socket.emit('create_room'); 

        socket.on('room_created', data => {
            myRoomId = data.room_id;
            GLOBAL_CONFIG = data.roles_config;
            document.getElementById('room-id-display').innerText = myRoomId;
            renderAllSliders();
            updateTotalCounter();
            
            // K√≠ch ho·∫°t n√∫t Start n·ªïi l·∫ßn ƒë·∫ßu
            if(window.innerWidth <= 768) document.getElementById('floating-start-btn').style.display = 'flex';
        });

        // --- RENDER SLIDERS ---
        function renderAllSliders() {
            let groups = { villager: [], wolf: [], neutral: [] };
            for (const [rID, info] of Object.entries(GLOBAL_CONFIG)) {
                if(info.team === 'wolf') groups.wolf.push(rID);
                else if(info.team === 'neutral') groups.neutral.push(rID);
                else groups.villager.push(rID);
            }
            renderSlider('villager', groups.villager, "ctrl-villager");
            renderSlider('wolf', groups.wolf, "ctrl-wolf");
            renderSlider('neutral', groups.neutral, "ctrl-neutral");
        }

        function renderSlider(groupName, roleIDs, ctrlId) {
            const container = document.getElementById('slider-' + groupName);
            container.innerHTML = '';
            
            roleIDs.forEach(rID => {
                const info = GLOBAL_CONFIG[rID];
                const card = document.createElement('div');
                card.className = 'card';
                card.id = `card-${rID}`;
                
                card.onclick = () => {
                    card.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
                    setActiveRole(groupName, rID, ctrlId);
                };

                const badge = document.createElement('div');
                badge.className = 'qty-badge';
                badge.id = `badge-${rID}`;
                badge.innerText = SELECTED_COUNTS[rID] || 0;
                if(SELECTED_COUNTS[rID] > 0) badge.style.display = 'flex';

                const zoomBtn = document.createElement('div');
                zoomBtn.className = 'zoom-btn';
                zoomBtn.innerHTML = 'üîç';
                zoomBtn.onclick = (e) => { e.stopPropagation(); viewCard(rID); };

                card.innerHTML = `<img src="/static/assets/${info.img}" class="card-img">`;
                card.appendChild(badge);
                card.appendChild(zoomBtn);
                container.appendChild(card);
            });

            container.addEventListener('scroll', () => { detectActiveCard(container, roleIDs, groupName, ctrlId); });
            if(roleIDs.length > 0) setTimeout(() => { setActiveRole(groupName, roleIDs[0], ctrlId); }, 500);
        }

        function detectActiveCard(container, roleIDs, groupName, ctrlId) {
            const center = container.scrollLeft + (container.offsetWidth / 2);
            let closest = null;
            let minDist = Infinity;
            roleIDs.forEach(rID => {
                const el = document.getElementById(`card-${rID}`);
                const elCenter = el.offsetLeft + (el.offsetWidth / 2);
                const dist = Math.abs(center - elCenter);
                if(dist < minDist) { minDist = dist; closest = rID; }
            });
            if(closest && ACTIVE_ROLES[groupName] !== closest) {
                setActiveRole(groupName, closest, ctrlId);
            }
        }

        function setActiveRole(groupName, rID, ctrlId) {
            ACTIVE_ROLES[groupName] = rID;
            const container = document.getElementById('slider-' + groupName);
            Array.from(container.children).forEach(c => c.classList.remove('active'));
            const activeCard = document.getElementById(`card-${rID}`);
            if(activeCard) activeCard.classList.add('active');
            renderControlPanel(ctrlId, rID);
        }

        function renderControlPanel(ctrlId, rID) {
            const panel = document.getElementById(ctrlId);
            const info = GLOBAL_CONFIG[rID];
            const count = SELECTED_COUNTS[rID] || 0;
            panel.innerHTML = `
                <div class="ctrl-role-name">${info.name}</div>
                <div class="ctrl-role-desc">${info.desc}</div>
                <div class="ctrl-inputs">
                    <div class="btn-qty" onclick="changeQty('${rID}', -1)">-</div>
                    <input class="inp-qty" id="inp-${rID}" value="${count}" readonly>
                    <div class="btn-qty" onclick="changeQty('${rID}', 1)">+</div>
                </div>
            `;
        }

        function changeQty(rID, delta) {
            let current = SELECTED_COUNTS[rID] || 0;
            let newVal = current + delta;
            if(newVal < 0) newVal = 0;
            SELECTED_COUNTS[rID] = newVal;
            
            const inp = document.getElementById(`inp-${rID}`);
            if(inp) inp.value = newVal;
            
            const badge = document.getElementById(`badge-${rID}`);
            if(badge) {
                badge.innerText = newVal;
                badge.style.display = newVal > 0 ? 'flex' : 'none';
            }
            updateTotalCounter();
        }

        function updateTotalCounter() {
            let total = 0;
            for(let key in SELECTED_COUNTS) total += SELECTED_COUNTS[key];
            const pCount = parseInt(document.getElementById('p-count').innerText) || 0;
            
            // Update Desktop Counter
            const txt = document.getElementById('total-roles');
            txt.innerText = total;
            txt.style.color = (total === pCount && total > 0) ? '#4caf50' : '#ff5252';
            document.getElementById('total-players').innerText = pCount;

            // Update Mobile Floating Button
            document.getElementById('float-roles').innerText = total;
            document.getElementById('float-players').innerText = pCount;
            const floatBtn = document.getElementById('floating-start-btn');
            floatBtn.style.backgroundColor = (total === pCount && total > 0) ? '#2e7d32' : '#c62828';
        }

        // --- SYSTEM ---
        function viewCard(rID) {
            const info = GLOBAL_CONFIG[rID];
            if(!info) return;
            const modal = document.getElementById('card-modal');
            const img = document.getElementById('modal-img-display');
            img.src = '/static/assets/' + info.img;
            modal.style.display = 'flex';
        }
        function closeModal() { document.getElementById('card-modal').style.display = 'none'; }
        function copyRoomID() { navigator.clipboard.writeText(myRoomId); alert("ƒê√£ copy ID!"); }

        socket.on('admin_update', data => { 
            const list = document.getElementById('player-list');
            document.getElementById('p-count').innerText = data.players.length;
            list.innerHTML = '';
            data.players.forEach(p => {
                const div = document.createElement('div');
                div.className = 'player-row';
                let statusClass = p.alive ? 'p-alive' : 'p-dead';
                div.innerHTML = `<span class="${statusClass}">${p.name}</span> <div>${p.alive ? '‚ù§Ô∏è' : 'üíÄ'} <span class="kick-x" onclick="kick('${p.sid}')">üö´</span></div>`;
                list.appendChild(div);
            });
            updateTotalCounter();
        });

        socket.on('server_log', data => {
            const box = document.getElementById('log-console');
            let time = new Date().toLocaleTimeString('vi-VN', {hour12:false});
            box.innerHTML += `<div><span style="color:#555">[${time}]</span> ${data.msg}</div>`;
            box.scrollTop = box.scrollHeight;
        });

        function sendAdminChat() {
            const inp = document.getElementById('admin-msg-input');
            const msg = inp.value.trim();
            if (msg && myRoomId) {
                socket.emit('admin_chat_msg', {room_id: myRoomId, msg: msg});
                inp.value = ''; 
            }
        }
        function startGame() {
            let total = 0;
            for(let key in SELECTED_COUNTS) total += SELECTED_COUNTS[key];
            let players = parseInt(document.getElementById('p-count').innerText);
            
            let finalRoles = {};
            for(let [key, val] of Object.entries(SELECTED_COUNTS)) if(val > 0) finalRoles[key] = val;

            if(total != players) {
                if(!confirm(`‚ö†Ô∏è L·ªách s·ªë l∆∞·ª£ng: ${total} Role / ${players} Ng∆∞·ªùi.\nTi·∫øp t·ª•c?`)) return;
            }
            socket.emit('admin_start_game', {room_id: myRoomId, roles: finalRoles});
        }
        function endDiscuss() { socket.emit('admin_end_discussion', {room_id: myRoomId}); }
        function kick(sid) { if(confirm("Kick ng∆∞·ªùi n√†y?")) socket.emit('admin_kick', {room_id: myRoomId, sid: sid}); }
    </script>
</body>
</html>